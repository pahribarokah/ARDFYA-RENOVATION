@startuml

!theme plain
skinparam backgroundColor white
skinparam shadowing false
skinparam handwritten false

' Styling sesuai contoh yang diberikan
skinparam participant {
    BackgroundColor #E3F2FD
    BorderColor #1976D2
    BorderThickness 2
    FontSize 11
}

skinparam arrow {
    Color black
    Thickness 2
}

skinparam sequence {
    ArrowColor black
    ActorBorderColor black
    LifeLineBorderColor black
    ParticipantBorderColor #1976D2
    ParticipantBackgroundColor #E3F2FD
    BoxBorderColor black
}

hide footbox

title **Sequence Diagram - UC12: Download Kontrak PDF**

participant "Customer" as Customer
participant "ContractViewPage" as ContractPage
participant "CustomerContractController" as ContractCtrl
participant "Contract Model" as ContractModel

Customer -> ContractPage: 1: DownloadContract (project_id, action_type)
activate ContractPage

ContractPage -> ContractCtrl: 1.1: downloadPDF(project_id, action_type)
activate ContractCtrl

ContractCtrl -> ContractModel: 1.1.1: findByProject(project_id)
activate ContractModel

alt [Contract Available]
    ContractModel --> ContractCtrl: 1.1.1.1: contractData()
    
    alt [Preview Action]
        ContractCtrl -> ContractModel: 1.1.1.1.1: generatePDF()
        ContractModel --> ContractCtrl: 1.1.1.1.1.1: pdfPreview()
        ContractCtrl --> ContractPage: 1.1.1.1.1.1.1: showPDFPreview()
        ContractPage --> Customer: 1.1.1.1.1.1.1.1: displayPDFInBrowser()
        
    else [Direct Download]
        ContractCtrl -> ContractModel: 1.1.1.1.2: generatePDF()
        ContractModel --> ContractCtrl: 1.1.1.1.2.1: pdfFile()
        ContractCtrl -> ContractModel: 1.1.1.1.2.1.1: getFormattedAmountAttribute()
        ContractModel --> ContractCtrl: 1.1.1.1.2.1.1.1: formattedAmount()
        ContractCtrl --> ContractPage: 1.1.1.1.2.1.2: streamPDFDownload()
        ContractPage --> Customer: 1.1.1.1.2.1.2.1: downloadPDFFile()
    end
    
    ContractCtrl -> ContractModel: 1.1.1.2: updateDownloadLog()
    ContractModel --> ContractCtrl: 1.1.1.2.1: logUpdated()
    
else [Contract Not Available]
    ContractModel --> ContractCtrl: 1.1.1.3: contractNotFound()
    ContractCtrl --> ContractPage: 1.1.1.3.1: showContractPending()
    ContractPage --> Customer: 1.1.1.3.1.1: displayPendingMessage()
end

deactivate ContractModel
deactivate ContractCtrl
deactivate ContractPage

@enduml
