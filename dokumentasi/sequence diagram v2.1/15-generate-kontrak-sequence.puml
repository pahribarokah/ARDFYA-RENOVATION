@startuml

!theme plain
skinparam backgroundColor white
skinparam shadowing false
skinparam handwritten false

' Styling sesuai contoh yang diberikan
skinparam participant {
    BackgroundColor #E3F2FD
    BorderColor #1976D2
    BorderThickness 2
    FontSize 11
}

skinparam arrow {
    Color black
    Thickness 2
}

skinparam sequence {
    ArrowColor black
    ActorBorderColor black
    LifeLineBorderColor black
    ParticipantBorderColor #1976D2
    ParticipantBackgroundColor #E3F2FD
    BoxBorderColor black
}

hide footbox

title **Sequence Diagram - UC15: Generate Kontrak**

participant "Admin" as Admin
participant "ContractGeneratePage" as ContractPage
participant "AdminContractController" as ContractCtrl
participant "Contract Model" as ContractModel

Admin -> ContractPage: 1: GenerateContract (project_id, contract_data)
activate ContractPage

ContractPage -> ContractCtrl: 1.1: store(project_id, contract_data)
activate ContractCtrl

ContractCtrl -> ContractModel: 1.1.1: create(contract_data)
activate ContractModel

ContractModel -> ContractModel: 1.1.1.1: generateContractNumber()
ContractModel -> ContractModel: 1.1.1.2: project()
ContractModel -> ContractModel: 1.1.1.3: user()

ContractModel --> ContractCtrl: 1.1.1.4: contractCreated()

alt [Preview Contract]
    ContractCtrl -> ContractModel: 1.1.1.5: generatePDF()
    ContractModel --> ContractCtrl: 1.1.1.5.1: pdfPreview()
    ContractCtrl --> ContractPage: 1.1.1.5.1.1: showPreview()
    ContractPage --> Admin: 1.1.1.5.1.1.1: displayPreview()
    
    Admin -> ContractPage: 1.1.1.5.1.1.1.1: approveContract()
    ContractPage -> ContractCtrl: 1.1.1.5.1.1.1.1.1: finalizeContract()
    
else [Direct Generate]
    ContractCtrl -> ContractModel: 1.1.1.6: generatePDF()
    ContractModel --> ContractCtrl: 1.1.1.6.1: finalPDF()
end

ContractCtrl -> ContractModel: 1.1.2: getFormattedAmountAttribute()
ContractModel --> ContractCtrl: 1.1.2.1: formattedAmount()

ContractCtrl -> ContractModel: 1.1.2.2: updateContractStatus('active')
ContractModel --> ContractCtrl: 1.1.2.2.1: statusUpdated()

ContractCtrl --> ContractPage: 1.1.2.2.1.1: showGenerateSuccess()
ContractPage --> Admin: 1.1.2.2.1.1.1: displaySuccessMessage()

deactivate ContractModel
deactivate ContractCtrl
deactivate ContractPage

@enduml
