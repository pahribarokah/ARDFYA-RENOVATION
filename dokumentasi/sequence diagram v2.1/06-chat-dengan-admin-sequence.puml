@startuml

!theme plain
skinparam backgroundColor white
skinparam shadowing false
skinparam handwritten false

' Styling sesuai contoh yang diberikan
skinparam participant {
    BackgroundColor #E3F2FD
    BorderColor #1976D2
    BorderThickness 2
    FontSize 11
}

skinparam arrow {
    Color black
    Thickness 2
}

skinparam sequence {
    ArrowColor black
    ActorBorderColor black
    LifeLineBorderColor black
    ParticipantBorderColor #1976D2
    ParticipantBackgroundColor #E3F2FD
    BoxBorderColor black
}

hide footbox

title **Sequence Diagram - UC06: Chat dengan Admin**

participant "Customer" as Customer
participant "CustomerChatPage" as ChatPage
participant "ChatController" as ChatCtrl
participant "Chat Model" as ChatModel

Customer -> ChatPage: 1: SendMessage (message, file, inquiry_context)
activate ChatPage

ChatPage -> ChatCtrl: 1.1: store(message_data)
activate ChatCtrl

ChatCtrl -> ChatModel: 1.1.1: getMessages(customer_id)
activate ChatModel

ChatModel --> ChatCtrl: 1.1.1.1: chatHistory()

alt [Text Message]
    ChatCtrl -> ChatModel: 1.1.1.2: store(customer_message)
    ChatModel --> ChatCtrl: 1.1.1.2.1: messageStored()
    ChatCtrl --> ChatPage: 1.1.1.2.1.1: showMessageSent()
    ChatPage --> Customer: 1.1.1.2.1.1.1: displaySentMessage()
    
else [File Upload]
    ChatCtrl -> ChatModel: 1.1.1.3: store(message_with_file)
    ChatModel --> ChatCtrl: 1.1.1.3.1: fileMessageStored()
    ChatCtrl --> ChatPage: 1.1.1.3.1.1: showFileSent()
    ChatPage --> Customer: 1.1.1.3.1.1.1: displaySentFile()
    
else [Inquiry Context Message]
    ChatCtrl -> ChatModel: 1.1.1.4: store(context_message)
    ChatModel --> ChatCtrl: 1.1.1.4.1: contextMessageStored()
    ChatCtrl --> ChatPage: 1.1.1.4.1.1: showContextMessage()
    ChatPage --> Customer: 1.1.1.4.1.1.1: displayContextMessage()
end

ChatCtrl -> ChatModel: 1.1.2: scopeUnread()
ChatModel --> ChatCtrl: 1.1.2.1: unreadCount()

ChatCtrl --> ChatPage: 1.1.2.1.1: updateChatInterface()
ChatPage --> Customer: 1.1.2.1.1.1: showUpdatedChat()

deactivate ChatModel
deactivate ChatCtrl
deactivate ChatPage

@enduml
